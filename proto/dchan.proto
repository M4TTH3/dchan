syntax = "proto3";

package dchan;

option go_package = "github.com/m4tth3/dchan/proto";

import "google/protobuf/empty.proto";

// ReceiveRequest contains Gob-encoded data to be decoded by the server
// TODO: make it support chunking
message ReceiveRequest {
  // Data contains the Gob-encoded struct
  bytes data = 1;
  string namespace = 2;
}

// ReceiveResponse acknowledges receipt of the data
// If the server is no longer receiving, the received field will be false.
message ReceiveResponse {
  bool received = 1;
}

// ReceiverRequest is used to register or unregister a receiver for a namespace.
// It contains the namespace, the server ID of the receiver, and the requester.
//
// This is sent to the leader to register or unregister a receiver.
message ReceiverRequest {
  string namespace = 1;
  string server_id = 2;
  string requester = 3;
}

// DChanService provides RPC methods for distributed channel operations
service DChanService {
  // Receive accepts Gob-encoded data for the server to decode
  rpc Receive(ReceiveRequest) returns (ReceiveResponse);

  rpc RegisterReceiver(ReceiverRequest) returns (google.protobuf.Empty);
  rpc UnregisterReceiver(ReceiverRequest) returns (google.protobuf.Empty);
}

